{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}

<div class="container justify-content-center makeShadow">
    <div class="row d-flex flex-column justify-content-center makeColor p-4">
        <h1 class="text-center font-weight-bold text-white">D<i class="fa fa-heartbeat text-danger"></i>nati<i
                class="fa fa-globe h3 text-success"></i>n</h1>
        <p class="text-center font-weight-bolder text-light lead">Giving little can help a lot.</p>
        <p class="text-center text-secondary h6">Don't Have an Account?<a class="h6 text-light text-primary"
                href="{{url_for('add_user')}}">
                Sign up</a>
        </p>
    </div>
</div>
<hr class="bg-light makeHr" />
<div class="container makeColor">
    <div class="row">
        <div class="col">
            <div class="btn-group sort-btn mt-2 ml-1">
                <button class="btn btn-info" type="button" data-toggle="dropdown" aria-haspopup="true"
                    aria-expanded="false">Sort</button>
                <button class="btn btn-danger dropdown-toggle" data-sort="none"><i class="fa fa-sort"></i></button>
                <!-- .dropdown-toggle adds rounded borders and reduces padding. It does not trigger dropdowns. -->
                <ul class="dropdown-menu">
                    <li><a href="#" tabindex="-1" data-type="alpha">Name</a></li>
                    <li><a href="#" tabindex="-1" data-type="numeric">Date</a></li>
                </ul>
            </div>
        </div>
        <div class="col"></div>
        <div class="col"></div>
        <div class="col mt-2 mr-1">
            <form class="form-inline">
                <input class="form-control" style="width: 350px;" type="search" placeholder="Search"
                    aria-label="Search">
            </form>
        </div>
    </div>
    <div class="row p-2">
        {% for fundraiser in all_fundraisers %}
        <div class="col-lg-4 d-flex align-items-stretch p-2">
            <div class="card-deck">
                <div class="card makeShadow">
                    <div class="card-header">
                        <h5 class="card-title"><i class="fas fa-star-of-life pr-1"></i>{{ fundraiser.title|title }}
                        </h5>
                    </div>
                    <a href="{{ url_for('fundraiser', id=fundraiser.id)}}"><img class="img-fluid"
                            src="{{ url_for('static', filename='images/fundraisers/' + fundraiser.fundraiser_pic)}}"
                            alt="Fundraiser image"></a>
                    <div class="card-body p-3">
                        <p class="text-success"><small>Updated on {{ fundraiser.date_created }}</small></p>
                        <div>
                            <p class="truncate-line-clamp text-muted h6">{{ fundraiser.description|capitalize }}</p>
                            <a class="float-right" href="{{ url_for('fundraiser', id=fundraiser.id)}}">continued</a>
                        </div>
                        <div class="progress mt-5">
                            <div class="progress-bar bg-info progress-bar-striped" style="width: 0%" role="progressbar"
                                aria-valuemin="0" aria-valuemax="100">
                                <span class="progress-bar-label text-left ml-1">
                                    {{ fundraiser.current_process }}%</span>
                            </div>
                        </div>
                        <p class="text-right"><span>{{ fundraiser.current_process }}%</span> of <span
                                class="nums">{{fundraiser.fund_goal }}</span><span> goal</span>
                        </p>

                        <div class="row text-center">
                            <div class="col">
                                <p class="h5 text-primary">Raised</p>
                                <p class="nums">{{ fundraiser.raised_amount}}</p>
                            </div>

                            <div class="col">
                                <p class="h5 text-primary">Donors</p>
                                {{fundraiser.num_of_donors}}
                            </div>

                            <div class="col">
                                <a class="btn btn-outline-danger btn-sm"
                                    href="{{ url_for('donation', id=fundraiser.id)}}">Donate now</a>
                            </div>

                        </div>
                        <p><span class="text-secondary"><small>Created by</small> </span></p>
                        <p><img src="{{ url_for('static', filename='images/users/' + fundraiser.funder.user_pic)}}"
                                alt="User Avatar" width="30" height="30" class="rounded-circle ml-3">
                            <span class="h6 text-info ml-2">{{ fundraiser.funder.name|title }}</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
</div>
<script>
    // Make progress-bar processing
    '{% set n = 1 %}'
    var bar = document.querySelectorAll(".progress-bar");
    var i = '{{ all_fundraisers.count() }}'
    function makeProgress() {
        while (i > 0) {
            '{% for n in range(1, all_fundraisers.count() + 1)%}'
            bar[i - 1].style.width = '{{ all_fundraisers[all_fundraisers.count() - n].current_process  }}' + "%";
            bar[i - 1].innerText = '{{ all_fundraisers[all_fundraisers.count() - n].current_process  }}' + "%";
            i--;
            '{% endfor %}'
        }
    }
    makeProgress()
</script>
{% endblock %}